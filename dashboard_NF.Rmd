---
title: "Extra!"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    social: menu
    source_code: embed
---


####
NORFLU %>% 
  leaflet() %>% 
  addTiles() %>% 
  addPolygons(fillColor = "grey",
              highlight = highlightOptions(weight = 1,
                                           color = "red",
                                           fillOpacity = 0.7,
                                           bringToFront = TRUE),
              label = ~NM_MUNICIP) %>% 
  addCircleMarkers(data = dori,
                   ~decimalLongitude,
                   ~decimalLatitude,
                   radius = 5,
                   label = ~as.character(datasetName),
                   color = ~pal(dori$datasetName),
                   stroke = FALSE, fillOpacity = 0.5) %>%
  addLegend('bottomright',
          colors = unique(pal(dori$datasetName)),
          labels = unique(dori$datasetName),
          title = 'Dataset',
          opacity = 0.5)


rank <- campoxxx %>% 
  group_by(kingdom, phylum, family) %>% 
  summarise(richness = n_distinct(paste(genus, species))) %>% 
  arrange(-richness) %>% 
  pull(family)


campoxxx %>% 
  group_by(kingdom, phylum, class) %>% 
  summarise(richness = n_distinct(paste(genus, species))) %>% 
  mutate(phylum = factor(phylum, levels = phylum)) %>% 
  ggplot(aes(y = richness, x = class, fill = kingdom)) +
    geom_bar(stat = 'identity') +
    theme_classic() +
    coord_flip() +
    facet_grid(~kingdom, scales = "free")


### IUCN redlist
# https://www.youtube.com/watch?v=4T6GXtptmj4

# https://bdj.pensoft.net/article/20530/

# https://bookdown.org/yihui/rmarkdown/dashboard-components.html





```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(leaflet)

campos <- read.delim("~/Downloads/0251266-210914110416597.csv")
```

# Lente Ecológica

## Row

### Biodiversidade

```{r}

rank <- campoxxx %>% 
  mutate(kingdom = factor(kingdom, levels = c("Viruses", "Bacteria", "Chromista", "Fungi", "Plantae", "Animalia", "incertae sedis"))) %>% 
  group_by(kingdom, phylum) %>% 
  summarise(spp = n_distinct(paste(genus, species))) %>% 
  filter(!phylum %in% c(NA, "")) %>% 
  arrange(kingdom, spp) %>% 
  pull(phylum)

a1 <- campoxxx %>% 
  mutate(kingdom = factor(kingdom, levels = c("Animalia", "Plantae", "Fungi", "Chromista", "Bacteria", "Viruses", "incertae sedis"))) %>% 
  group_by(kingdom, phylum) %>% 
  summarise(spp = n_distinct(paste(genus, species))) %>% 
  filter(!phylum %in% c(NA, "")) %>% 
  mutate(phylum = factor(phylum, levels = rank)) %>% 
  ggplot(aes(y = phylum, x = spp, fill = kingdom)) +
    geom_bar(stat = 'identity') +
    facet_wrap(kingdom ~ ., scales = 'free', nrow = 1) +
    theme_classic() +
    theme(legend.position = "")

ggplotly(a1)


ggplotly(campoxxx %>% 
  mutate(kingdom = factor(kingdom, levels = c("Animalia", "Plantae", "Fungi", "Chromista", "Bacteria", "Viruses", "incertae sedis"))) %>% 
  group_by(kingdom, phylum, class) %>% 
  summarise(spp = n_distinct(paste(genus, species))) %>% 
  filter(!phylum %in% c(NA, "")) %>% 
  mutate(phylum = factor(phylum, levels = rank)) %>% 
  ggplot(aes(y = phylum, x = spp, fill = class)) +
    geom_bar(stat = 'identity') +
    facet_wrap(kingdom ~ ., scales = 'free', nrow = 1) +
    theme_classic() +
    theme(legend.position = ""))
```

### Boxplot

```{r chart B}
a2 <- iris %>% 
  pivot_longer(cols = Sepal.Length:Petal.Width, names_to = "variable", values_to = "size") %>% 
  ggplot(aes(x = variable, y = size, color = Species)) +
    geom_boxplot() +
    facet_grid(~ Species) +
    theme_classic() +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
    labs(y = "Size (cm)", x = "")

ggplotly(a2)

```

### GAUGE

```{r}
gauge(91, min = 0, max = 100, symbol = '%', gaugeSectors(
  success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
))
```


## Row

### Scatterplot
```{r}

a3 <- iris %>% 
  ggplot(aes(x = Petal.Length, y = Petal.Width, color = Species)) +
    geom_point() +
    theme_classic()

ggplotly(a3)

```


### Locais de amostragem (Península de Gaspe) 

```{r chart C}
# conferir no mapa
iris %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers(~lon,
             ~lat)
```

# Dori

## Row

### Ocorrências de *Paracanthurus hepatus*

```{r mapa_dori}

dori <- read.csv("data/occ_GBIF-OBIS_par_hepa.csv", header = TRUE)

pal <- colorFactor(palette = "viridis", domain = unique(dori$datasetName))

dori %>% 
  leaflet() %>% 
  addTiles() %>% 
  addCircleMarkers(~decimalLongitude,
                   ~decimalLatitude,
                   radius = 5,
                   label = ~as.character(datasetName),
                   color = ~pal(dori$datasetName),
                   stroke = FALSE, fillOpacity = 0.5) %>% 
  addLegend('bottomright', 
            colors = unique(pal(dori$datasetName)), 
            labels = unique(dori$datasetName),
            title = 'Dataset',
            opacity = 0.5) %>% 
  addPolygons(fillColor = "grey",
              highlight = highlightOptions(weight = 5,
                                           color = "red",
                                           fillOpacity = 0.7,
                                           bringToFront = TRUE),
              label = ~NAME)

```