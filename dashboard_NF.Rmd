---
title: "Extra!"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    social: menu
    source_code: embed
---

### IUCN redlist
# https://www.youtube.com/watch?v=4T6GXtptmj4

# https://bdj.pensoft.net/article/20530/

# https://bookdown.org/yihui/rmarkdown/dashboard-components.html

# https://plotly.com/r/time-series/



```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(leaflet)
library(sf)

campos <- read.csv("data/campos_gbif_25apr2022.csv", header = T)

NORFLU <- sf::st_read("data/NORFLU/map.shp")

NORFLU <- rgdal::readOGR("data/NORFLU/map.shp")


```

# Dori

## Row

### Ocorrências de *Paracanthurus hepatus*

```{r mapa_dori}

pal <- colorFactor(palette = "viridis", domain = unique(campos$kingdom))

NORFLU %>% 
  leaflet() %>% 
  addTiles() %>% 
  addPolygons(fillColor = "grey",
              highlight = highlightOptions(weight = 1,
                                           color = "red",
                                           fillOpacity = 0.7,
                                           bringToFront = TRUE),
              label = ~NM_MUNICIP) %>% 
  addCircleMarkers(data = campos,
                   ~decimalLongitude,
                   ~decimalLatitude,
                   radius = 5,
                   #label = ~as.character(datasetName),
                   color = ~pal(campos$kingdom),
                   stroke = FALSE, fillOpacity = 0.5) %>%
  addLegend('bottomright',
          colors = unique(pal(campos$kingdom)),
          labels = unique(campos$kingdom),
          title = 'Dataset',
          opacity = 0.5)

```


# Lente Ecológica

## Row

### Biodiversidade

```{r}

rank <- campos %>% 
  mutate(kingdom = factor(kingdom, levels = c("Viruses", "Bacteria", "Chromista", "Fungi", "Plantae", "Animalia", "incertae sedis"))) %>% 
  group_by(kingdom, phylum) %>% 
  summarise(spp = n_distinct(paste(genus, species))) %>% 
  filter(!phylum %in% c(NA, "")) %>% 
  arrange(kingdom, spp) %>% 
  pull(phylum)

a1 <- campos %>% 
  mutate(kingdom = factor(kingdom, levels = c("Animalia", "Plantae", "Fungi", "Chromista", "Bacteria", "Viruses", "incertae sedis"))) %>% 
  group_by(kingdom, phylum) %>% 
  summarise(spp = n_distinct(paste(genus, species))) %>% 
  filter(!phylum %in% c(NA, "")) %>% 
  mutate(phylum = factor(phylum, levels = rank)) %>% 
  ggplot(aes(y = phylum, x = spp, fill = kingdom)) +
    geom_bar(stat = 'identity') +
    facet_wrap(kingdom ~ ., scales = 'free', nrow = 1) +
    theme_classic() +
    theme(legend.position = "")

ggplotly(a1)


ggplotly(campos %>% 
  mutate(kingdom = factor(kingdom, levels = c("Animalia", "Plantae", "Fungi", "Chromista", "Bacteria", "Viruses", "incertae sedis"))) %>% 
  group_by(kingdom, phylum, class) %>% 
  summarise(spp = n_distinct(paste(genus, species))) %>% 
  filter(!phylum %in% c(NA, "")) %>% 
  mutate(phylum = factor(phylum, levels = rank)) %>% 
  ggplot(aes(y = phylum, x = spp, fill = class)) +
    geom_bar(stat = 'identity') +
    facet_wrap(kingdom ~ ., scales = 'free', nrow = 1) +
    theme_classic() +
    theme(legend.position = ""))
```

### Boxplot

```{r chart B}
a2 <- iris %>% 
  pivot_longer(cols = Sepal.Length:Petal.Width, names_to = "variable", values_to = "size") %>% 
  ggplot(aes(x = variable, y = size, color = Species)) +
    geom_boxplot() +
    facet_grid(~ Species) +
    theme_classic() +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
    labs(y = "Size (cm)", x = "")

ggplotly(a2)

```

### GAUGE

```{r}
gauge(91, min = 0, max = 100, symbol = '%', gaugeSectors(
  success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
))
```


## Row

### Scatterplot
```{r}

a3 <- campos %>% 
  group_by(kingdom) %>% 
  summarise(spp = n_distinct(genus)) %>% 
  ggplot(aes(y = spp, color = kingdom)) +
    geom_histogram() +
    theme_classic()

ggplotly(a3)

```


### Locais de amostragem (Península de Gaspe) 

```{r chart C}
# conferir no mapa
campos %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers(~decimalLongitude,
             ~decimalLatitude)
```

